from llm_genplan.utils import get_next_state

def get_plan(task):
    plan = []
    balls = set(atom[1] for atom in task.init if atom[0] == 'at')
    for ball in balls:
        initial_room = next(atom[2] for atom in task.init if atom[0] == 'at' and atom[1] == ball)
        goal_room = next(atom[2] for atom in task.goal if atom[0] == 'at' and atom[1] == ball)
        gripper = next(atom[2] for atom in task.init if atom[0] == 'free')
        plan.append('(pick {} {} {})'.format(ball, initial_room, gripper))
        plan.append('(move {} {})'.format(initial_room, goal_room))
        plan.append('(drop {} {} {})'.format(ball, goal_room, gripper))
        atoms = set(task.init)
        for action in plan:
            atoms = get_next_state(task, atoms, action)
    return plan
